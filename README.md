

# Оптимізація YOLOv8 для сегментації кораблів за допомогою генетичного алгоритму

Цей проєкт демонструє комплексний підхід до навчання та оптимізації моделі сегментації YOLOv8s для виявлення та сегментації кораблів. Він включає автоматичне налаштування гіперпараметрів за допомогою генетичного алгоритму (ГА) з використанням бібліотеки DEAP, а також розширений пост-тренувальний аналіз та візуалізацію проблемних передбачень.

## Зміст

1.  [Огляд Проєкту](#огляд-проєкту)
2.  [Основні Характеристики](#основні-характеристики)
3.  [Структура Каталогів](#структура-каталогів)
4.  [Встановлення](#встановлення)
5.  [Підготовка Даних](#підготовка-даних)
6.  [Використання](#використання)
    * [Запуск в Google Colab](#запуск-в-google-colab)
    * [Локальний Запуск](#локальний-запуск)
7.  [Гіперпараметри Генетичного Алгоритму](#гіперпараметри-генетичного-алгоритму)
8.  [Результати та Аналіз](#результати-та-аналіз)
9.  [Подяка](#подяка)
10. [Ліцензія](#ліцензія)

## Огляд Проєкту

Метою цього проєкту є оптимізація продуктивності моделі YOLOv8s-seg на наборі даних HRSID (або аналогічному) для сегментації кораблів. Замість ручного підбору гіперпараметрів, використовується генетичний алгоритм для автоматичного пошуку найкращої комбінації параметрів навчання. Після налаштування, фінальна модель тренується з оптимальними гіперпараметрами, а потім проводиться детальний аналіз її продуктивності, включаючи візуалізацію помилок.

## Основні Характеристики

* **Автоматичне налаштування гіперпараметрів**: Використання бібліотеки `DEAP` для реалізації генетичного алгоритму, що оптимізує гіперпараметри навчання YOLOv8s.
* **Модель YOLOv8s-seg**: Використання легковагової моделі YOLOv8 для завдань сегментації.
* **Динамічна конфігурація `data.yaml`**: Автоматичне створення файлу конфігурації даних, що спрощує налаштування.
* **Гнучке завантаження даних**: Функції для завантаження шляхів до зображень та міток, з можливістю обмеження обсягу даних для швидких тестів.
* **Розширений пост-тренувальний аналіз**:
    * Побудова та збереження Precision-Recall кривих.
    * Побудова та збереження матриць плутанини.
* **Візуалізація проблемних передбачень**: Використання `supervision` для візуалізації хибних позитивних, хибних негативних та поганих відповідностей IoU на тестових зображеннях, що допомагає у розумінні недоліків моделі.
* **Сумісність з Google Colab**: Включено налаштування для легкого запуску у середовищі Google Colab, включаючи монтування Google Диска для збереження результатів.

## Структура Каталогів

Припускається, що ваші дані організовані у форматі YOLO, наприклад:
```content/HRSID_YOLO_Format/
├── train/
│   ├── images/
│   └── labels/
├── val/
│   ├── images/
│   └── labels/
└── test/
├── images/
└── labels/
```

Вихідні результати (налаштовані моделі, графіки, проблемні зображення) будуть збережені у каталозі `YOLOv8_GA_Results` на вашому Google Диску (або локально у `runs/ga_tuning`).
```/content/drive/MyDrive/YOLOv8_GA_Results/
├── data.yaml
├── final_tuned_run/
│   ├── weights/
│   │   ├── best.pt
│   │   └── last.pt
│   └── results.csv
│   └── confusion_matrix.png
│   └── PR_curve.png
│   └── ... (інші файли Ultralytics)
├── ga_run_XXXX/ (для кожного індивідуума ГА)
│   └── ...
└── problematic_test_images/
├── problematic_image1.jpg
└── problematic_image2.jpg
└── ...
```
## Встановлення

Для запуску цього проєкту вам знадобляться наступні бібліотеки:

```bash
pip install ultralytics==8.0.0  # Або інша сумісна версія
pip install deap
pip install supervision==0.17.0 # Або інша сумісна версія
pip install matplotlib seaborn pyyaml opencv-python numpy
```

Якщо ви використовуєте Google Colab, більшість цих бібліотек вже встановлені, за винятком deap та supervision, які можна встановити так:
```bash
!pip install ultralytics deap supervision matplotlib seaborn
```
## Підготовка Даних
Переконайтеся, що ваш набір даних для сегментації (наприклад, HRSID) знаходиться у форматі YOLOv8 (зображення та відповідні текстові файли міток з полігонами) і розташований за шляхами, вказаними на початку скрипту.

Якщо ваші дані знаходяться в іншому місці, оновіть змінні `train_images_dir, train_labels_dir` тощо у скрипті відповідно до ваших шляхів.

## Використання
Основний скрипт виконує весь процес: налаштування ГА, навчання фінальної моделі та аналіз.

### Запуск в Google Colab
1. Завантажте ваш набір даних (`HRSID_YOLO_Format` або аналогічний) до файлової системи Colab або залиште його на Google Диску та оновіть відповідні шляхи у скрипті.

2. Запустіть всі комірки у вашому ноутбуці. Скрипт автоматично змонтує Google Диск, якщо це необхідно, створить каталоги для результатів та розпочне процес оптимізації та навчання.

3. Результати будуть збережені у папці `/content/drive/MyDrive/YOLOv8_GA_Results` на вашому Google Диску.

### Локальний Запуск
1. Клонуйте репозиторій:
```bash

git clone [https://github.com/YourUsername/YourRepoName.git](https://github.com/YourUsername/YourRepoName.git)
cd YourRepoName
```
 Замініть `YourUsername/YourRepoName.git` на фактичний URL вашого репозиторію.

2. Розмістіть ваш набір даних у відповідних каталогах або оновіть шляхи до даних у скрипті.

3. Запустіть скрипт:
```bash

python main.py # Якщо ваш основний файл називається main.py
```
Результати будуть збережені у локальній папці `runs/ga_tuning`.

## Гіперпараметри Генетичного Алгоритму
Параметри ГА та їх діапазони визначені у словнику `HYPERPARAMETER_RANGES` у скрипті.

Ви можете налаштувати `POPULATION_SIZE` та `NUM_GENERATIONS` для генетичного алгоритму:

```bash
POPULATION_SIZE = 5   # Розмір популяції ГА (кількість індивідуумів за покоління)
NUM_GENERATIONS = 3   # Кількість поколінь ГА
CXPB = 0.7            # Ймовірність кросоверу
MUTPB = 0.2           # Ймовірність мутації
```
Важливе зауваження: Поточні значення `POPULATION_SIZE` та `NUM_GENERATIONS` є невеликими і призначені для швидких демонстрацій/тестів.
Для більш ефективного пошуку оптимальних гіперпараметрів, особливо на великих та складних задачах, рекомендується значно збільшити ці значення (наприклад, `POPULATION_SIZE` до 20-50, `NUM_GENERATIONS` до 10-50).

## Результати та Аналіз
Після завершення виконання скрипту у вихідному каталозі (`YOLOv8_GA_Results` або `runs/ga_tuning`) ви знайдете:

* Логи навчання для кожного індивідуума ГА та фінальної моделі.
* Ваги навченої моделі (`best.pt`, `last.pt`) у папці `final_tuned_run/weights/`.
* Графіки матриць плутанини (`Confusion_Matrix.png`).
* Папку `problematic_test_images/`, що містить зображення з тестового набору, на яких модель мала хибні позитивні, хибні негативні виявлення або погані відповідності IoU, з візуалізованими анотаціями.

Ці артефакти дозволять вам оцінити ефективність налаштування гіперпараметрів та зрозуміти сильні та слабкі сторони фінальної моделі.
